---
phase: 22-polish-validation
plan: "02"
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/RichTextEditor.tsx
  - src/components/NotePanel.tsx
autonomous: true
gap_closure: true
requirements:
  - RTE-01
  - RTE-04
must_haves:
  truths:
    - "Keyboard shortcut Cmd/Ctrl+B toggles bold on selected text or at cursor immediately"
    - "Text wraps properly in editor with word-wrap CSS"
    - "Character counter shows plain text length, not HTML length"
    - "Character counter shows red when reaching exactly 2000 characters"
  artifacts:
    - path: "src/components/RichTextEditor.tsx"
      provides: "TipTap editor with proper empty state initialization"
    - path: "src/components/NotePanel.tsx"
      provides: "Character counter with correct plain text calculation"
---

# Phase 22 Plan 02: Gap Closure - Keyboard Shortcut and Character Counter

**Objective:** Fix two UAT failures from 22-01 verification.

## Gap 1: Keyboard Shortcut Cmd/Ctrl+B

**Issue:** Bold only toggles AFTER typing first character, not immediately when shortcut is pressed.

**Root Cause:** Empty string initialization causes TipTap editor to lack proper selection context.

**Fix:** Initialize TipTap with '<p></p>' instead of empty string when content is empty.

## Gap 2: Character Counter Issues

**Issue 2a:** Text doesn't wrap - "text window just keeps expanding instead of wrapping"

**Root Cause:** Missing word-wrap CSS in .tiptap styles.

**Issue 2b:** Counter doesn't show red at limit - "do not see red once 2000 is hit"

**Root Cause:** NotePanel.tsx compares HTML length (noteText.length) instead of plain text length, and uses > instead of >=.

## Tasks

<task>
  <name>Fix empty state initialization for TipTap editor</name>
  <files>src/components/RichTextEditor.tsx</files>
  <action>
    At line 153 where `content` is passed to useEditor, add a check: if content is empty string, use '<p></p>' instead.

    Change:
    ```typescript
    content,
    ```

    To:
    ```typescript
    content: content || '<p></p>',
    ```

    This ensures TipTap initializes with a proper paragraph node, allowing keyboard shortcuts to work immediately on empty editor.
  </action>
  <verify>
    <automated>npm run build</automated>
    <manual>Start focus session, click in NotePanel editor, immediately press Cmd+B - text should become bold without typing first</manual>
  </verify>
  <done>Cmd/Ctrl+B toggles bold on empty editor without requiring typed characters first</done>
</task>

<task>
  <name>Add word-wrap CSS to TipTap editor</name>
  <files>src/components/RichTextEditor.tsx</files>
  <action>
    Add word-wrap: break-word to the .tiptap CSS class in the EditorArea styled component.

    In the .tiptap style block (around line 59-65), add:
    ```typescript
    word-wrap: break-word;
    overflow-wrap: break-word;
    ```

    This ensures long text strings wrap instead of expanding horizontally.
  </action>
  <verify>
    <automated>npm run build</automated>
    <manual>Type long word without spaces in NotePanel editor - text should wrap to next line instead of expanding</manual>
  </verify>
  <done>Text wraps properly in editor with word-wrap CSS</done>
</task>

<task>
  <name>Fix character counter to use plain text length and >= comparison</name>
  <files>src/components/NotePanel.tsx</files>
  <action>
    At lines 391-393 in NotePanel.tsx:

    1. Calculate plain text length by stripping HTML tags:
       ```typescript
       const plainTextLength = noteText.replace(/<[^>]*>/g, '').length;
       ```

    2. Change comparison from > to >=:
       Change from:
       ```typescript
       <CharacterCount $isOverLimit={noteText.length > maxNoteLength}>
         {noteText.length} / {maxNoteLength}
         {noteText.length > maxNoteLength && ' (limit reached)'}
       ```

       To:
       ```typescript
       <CharacterCount $isOverLimit={plainTextLength >= maxNoteLength}>
         {plainTextLength} / {maxNoteLength}
         {plainTextLength >= maxNoteLength && ' (limit reached)'}
       ```
  </action>
  <verify>
    <automated>npm run build</automated>
    <manual>Type exactly 2000 characters in NotePanel - counter should show red at exactly 2000, not only after</manual>
  </verify>
  <done>Character counter shows plain text length and red warning at exactly 2000 characters</done>
</task>

---

## Verification

After completing all tasks:

1. **Keyboard shortcut test:**
   - Start focus session
   - Click in NotePanel editor
   - Press Cmd+B (Mac) or Ctrl+B (Windows) immediately
   - Text should become bold without typing first

2. **Text wrapping test:**
   - Type a very long word without spaces
   - Text should wrap to next line, not expand horizontally

3. **Character counter test:**
   - Type exactly 2000 characters
   - Counter should show red/warning at 2000

## Success Criteria

- [ ] Cmd/Ctrl+B works on empty editor
- [ ] Text wraps in editor
- [ ] Character counter shows plain text length
- [ ] Counter shows red at exactly 2000 characters
- [ ] Build passes

## Output

After completion, create `.planning/phases/22-polish-validation/22-02-SUMMARY.md`

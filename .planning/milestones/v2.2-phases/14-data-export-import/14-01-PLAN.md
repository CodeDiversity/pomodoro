---
phase: 14-data-export-import
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/history/HistoryFilterBar.tsx
  - src/utils/csvExport.ts
  - src/features/history/historySelectors.ts
  - src/app/store.ts
autonomous: true
requirements:
  - EXPT-01
  - EXPT-02
  - EXPT-03
  - EXPT-04
  - EXPT-05
user_setup: []
must_haves:
  truths:
    - "User can export session data from History view as CSV file"
    - "Export respects current date filter (today/7 days/30 days/all)"
    - "CSV contains columns: date, duration, mode, notes, tags"
    - "Filename follows format pomodoro-sessions-YYYY-MM-DD.csv"
    - "Export triggers browser file download"
  artifacts:
    - path: "src/utils/csvExport.ts"
      provides: "CSV export utility with session to CSV conversion"
      exports: ["exportSessionsToCsv"]
    - path: "src/components/history/HistoryFilterBar.tsx"
      provides: "Export button in History view filter bar"
      contains: "ExportButton, onClick export handler"
    - path: "src/features/history/historySelectors.ts"
      provides: "Selector for filtered sessions by date range"
      exports: ["selectSessionsByDate"]
  key_links:
    - from: "HistoryFilterBar.tsx"
      to: "csvExport.ts"
      via: "import and call exportSessionsToCsv"
      pattern: "exportSessionsToCsv.*sessions"
    - from: "HistoryFilterBar.tsx"
      to: "historySelectors.ts"
      via: "useAppSelector selectFilteredSessions"
      pattern: "selectFilteredSessions.*dateFilter"
---

<objective>
Implement data export functionality from History view to CSV file
</objective>

<execution_context>
@/Users/michaelrobert/.claude/get-shit-done/workflows/execute-plan.md
@/Users/michaelrobert/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-data-export-import/14-CONTEXT.md

# Technical Context
- SessionRecord type defined in src/types/session.ts
- sessionStore.ts provides getAllSessions() function
- HistoryFilterBar.tsx already has filter controls (search, date dropdown, calendar)
- historySlice.ts manages dateFilter state in Redux
- historySelectors.ts has memoized selectors for filtered sessions
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CSV export utility</name>
  <files>src/utils/csvExport.ts</files>
  <action>
    Create src/utils/csvExport.ts with exportSessionsToCsv function that:
    - Accepts SessionRecord[] and dateFilter string
    - Uses historySelectors logic to filter sessions by date range (today/7days/30days/all)
    - Generates CSV with header row: date,duration,mode,notes,tags
    - Maps: startTimestamp -> date (YYYY-MM-DD format), actualDurationSeconds -> duration, mode, noteText -> notes, tags -> tags (comma-separated)
    - Creates Blob with MIME type text/csv
    - Triggers download via dynamically created anchor element
    - Filename format: pomodoro-sessions-YYYY-MM-DD.csv (current date)
  </action>
  <verify>npm run build succeeds</verify>
  <done>exportSessionsToCsv function exists, filters sessions by date, generates correct CSV format with headers</done>
</task>

<task type="auto">
  <name>Task 2: Add Export button to HistoryFilterBar</name>
  <files>src/components/history/HistoryFilterBar.tsx</files>
  <action>
    Modify HistoryFilterBar.tsx to:
    - Add ExportButton styled component (similar to CalendarButton styling)
    - Add onExport prop to HistoryFilterBarProps interface
    - Place ExportButton to the right of CalendarButton in FilterBarContainer
    - ExportButton triggers exportSessionsToCsv with filtered sessions when clicked
    - Uses useAppSelector to get selectFilteredSessions with current dateFilter
  </action>
  <verify>npm run build succeeds</verify>
  <done>Export button appears in History filter bar, triggers CSV download on click</done>
</task>

<task type="auto">
  <name>Task 3: Connect HistoryFilterBar to parent component</name>
  <files>src/components/history/HistoryDrawer.tsx</files>
  <action>
    Update HistoryDrawer.tsx to:
    - Add onExport handler that calls exportSessionsToCsv
    - Pass onExport to HistoryFilterBar component
  </action>
  <verify>npm run build succeeds</verify>
  <done>HistoryDrawer passes export handler to HistoryFilterBar, export flow complete</done>
</task>

</tasks>

<verification>
- Export button appears in History view filter bar
- Clicking export downloads a CSV file
- CSV contains correct columns: date, duration, mode, notes, tags
- Filename follows pomodoro-sessions-YYYY-MM-DD.csv format
- Export respects date filter (only exports filtered sessions)
</verification>

<success_criteria>
- EXPT-01: Export button appears in History view
- EXPT-02: Export respects date range filter
- EXPT-03: CSV format with columns: date, duration, mode, notes, tags
- EXPT-04: Filename: pomodoro-sessions-YYYY-MM-DD.csv
- EXPT-05: Download triggers browser file download
</success_criteria>

<output>
After completion, create `.planning/phases/14-data-export-import/14-01-SUMMARY.md`
</output>

---
phase: 03-history-stats
plan: '02'
type: execute
wave: 1
depends_on: []
files_modified: []
autonomous: true
requirements: [STAT-01, STAT-02, STAT-03, STAT-04]

must_haves:
  truths:
    - "User can see total focus time today"
    - "User can see total focus time last 7 days"
    - "User can see number of focus sessions today"
    - "User can see longest session in selected range"
    - "Stats are immediately visible without clicking anything"
  artifacts:
    - path: "src/utils/statsUtils.ts"
      provides: "Stats calculation functions"
    - path: "src/hooks/useFilteredStats.ts"
      provides: "Filtered stats hook"
    - path: "src/components/stats/StatCard.tsx"
      provides: "Individual stat card component"
    - path: "src/components/stats/StatsGrid.tsx"
      provides: "2x2 grid of stat cards"
  key_links:
    - from: "StatsGrid"
      to: "useFilteredStats"
      via: "session data"
    - from: "useFilteredStats"
      to: "statsUtils.calculateStats"
      via: "stat calculation"
---

<objective>
Build stats display with 4 productivity metrics in stat cards.

Purpose: Show users their productivity statistics at a glance.
Output: Stats components, calculation utilities.
</objective>

<execution_context>
@/Users/michaelrobert/.claude/get-shit-done/workflows/execute-plan.md
@/Users/michaelrobert/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-history-stats/03-CONTEXT.md
@.planning/phases/03-history-stats/03-RESEARCH.md
@src/types/session.ts
@src/services/sessionStore.ts

# User Decisions (LOCKED - honor exactly)
- Stats: Display as stat cards (not charts)
- 4 metrics: Total focus time today, Total focus time last 7 days, Sessions today, Longest session in range
- Layout: 2x2 grid of stat cards
- Labels: Descriptive ("Today", "Last 7 Days", etc.)
</context>

<tasks>

<task type="auto">
  <name>Create stats calculation utility</name>
  <files>src/utils/statsUtils.ts</files>
  <action>
Create stats calculation utility:

1. **src/utils/statsUtils.ts**:
   - Interface Stats { totalFocusTimeToday: number, totalFocusTimeLast7Days: number, sessionsToday: number, longestSession: number }
   - `calculateStats(sessions: SessionRecord[]): Stats`:
     - totalFocusTimeToday: sum of actualDurationSeconds for sessions where createdAt >= todayStart
     - totalFocusTimeLast7Days: sum for sessions where createdAt >= 7daysAgo
     - sessionsToday: count of sessions today
     - longestSession: max actualDurationSeconds across all sessions in range
   - Helper: getTodayStart(): Date - returns midnight of current day
   - Helper: getWeekAgo(): Date - returns date 7 days ago at midnight

The "range" for longest session uses the currently selected date filter (default to '7days')
  </action>
  <verify>
- File created with correct exports
- TypeScript compiles
- All 4 stats calculated correctly
  </verify>
  <done>
- statsUtils.ts exports calculateStats and helper functions
- Returns Stats interface with all 4 required metrics
</done>
</task>

<task type="auto">
  <name>Create useFilteredStats hook</name>
  <files>src/hooks/useFilteredStats.ts</files>
  <action>
Create useFilteredStats hook:
- Imports: calculateStats from statsUtils, SessionRecord type
- Props: sessions: SessionRecord[], dateFilter: DateFilter
- Filters sessions based on dateFilter before calculating stats:
  - 'today': only today's sessions
  - '7days': last 7 days
  - '30days': last 30 days
  - 'all': all sessions
- Returns: { stats, longestSessionInRange }
- Calls calculateStats with filtered sessions
- Re-calculates when sessions or dateFilter changes
  </action>
  <verify>
- Hook filters sessions by date range
- Stats update when filter changes
- Returns correct structure
  </verify>
  <done>
- useFilteredStats exports stats based on filtered sessions
- Responds to dateFilter changes
</done>
</task>

<task type="auto">
  <name>Create StatCard component</name>
  <files>src/components/stats/StatCard.tsx</files>
  <action>
Create StatCard component:
- Props: label: string, value: string, subtext?: string
- Display: Card style with label at top, large value in center
- Uses styled-components
- Clean, simple design (per user: "clean and simple, like a spreadsheet but prettier")
- Value formatted as duration string: "2h 15m" or "25m"
- Label: descriptive ("Today", "Last 7 Days", etc.)
- Subtext: optional, e.g., "3 sessions" for sessions count
  </action>
  <verify>
- Renders label and value
- Styled as card
- Value formatted appropriately
  </verify>
  <done>
- StatCard shows label and formatted value
- Card-style component with styled-components
</done>
</task>

<task type="auto">
  <name>Create StatsGrid component (2x2 layout)</name>
  <files>src/components/stats/StatsGrid.tsx</files>
  <action>
Create StatsGrid component:
- Props: stats: Stats, dateFilter: DateFilter
- Layout: 2x2 grid of StatCard components (per user decision)
- Cards in order:
  - Top-left: Total focus time today (label: "Today")
  - Top-right: Total focus time last 7 days (label: "Last 7 Days")
  - Bottom-left: Sessions today (label: "Sessions Today") - show subtext with count
  - Bottom-right: Longest session in range (label: "Longest Session")
- Fetches sessions and calculates stats using useFilteredStats
- Uses styled-components grid: display: grid, grid-template-columns: 1fr 1fr, gap: 1rem
- Responsive: single column on mobile (< 600px)
  </action>
  <verify>
- 2x2 grid layout
- All 4 stats displayed
- Responsive on mobile
- Stats update with date filter
  </verify>
  <done>
- StatsGrid shows 4 stat cards in 2x2 grid
- Cards display: Total focus time today, Total focus time last 7 days, Sessions today, Longest session
</done>
</task>

</tasks>

<verification>
- All 4 STAT requirements addressed
- User decisions implemented exactly (stat cards, 2x2 grid, labels)
- No charts (deferred to Phase 4)
- Stats immediately visible without clicking
</verification>

<success_criteria>
STAT-01: Display total focus time today
STAT-02: Display total focus time last 7 days
STAT-03: Display number of focus sessions today
STAT-04: Display longest focus session in selected range
</success_criteria>

<output>
After completion, create `.planning/phases/03-history-stats/03-02-SUMMARY.md`
</output>

---
phase: 03-history-stats
plan: '01'
type: execute
wave: 1
depends_on: []
files_modified: []
autonomous: true
requirements: [HIST-01, HIST-02, HIST-03, HIST-04, HIST-05, HIST-06, HIST-07, HIST-08]

must_haves:
  truths:
    - "User can browse list of past focus sessions"
    - "User can filter sessions by date range"
    - "User can search sessions by note or tag text"
    - "User can view full session details in a drawer"
    - "User can edit session note and tags with auto-save"
    - "User can delete sessions with confirmation"
    - "User sees empty state when no sessions exist"
  artifacts:
    - path: "src/utils/dateUtils.ts"
      provides: "Date formatting utilities"
    - path: "src/utils/durationUtils.ts"
      provides: "Duration formatting utilities"
    - path: "src/hooks/useSessionHistory.ts"
      provides: "Session fetching and filtering hook"
    - path: "src/components/history/HistoryFilterBar.tsx"
      provides: "Filter chips and search input"
    - path: "src/components/history/HistoryItem.tsx"
      provides: "Single session row component"
    - path: "src/components/history/HistoryList.tsx"
      provides: "Main history list container"
    - path: "src/components/history/HistoryDrawer.tsx"
      provides: "Slide-out session details drawer"
  key_links:
    - from: "useSessionHistory"
      to: "sessionStore.getAllSessions"
      via: "IndexedDB query"
    - from: "HistoryList"
      to: "HistoryDrawer"
      via: "selectedSession state"
    - from: "HistoryDrawer"
      to: "sessionStore.saveSession"
      via: "auto-save debounce"
---

<objective>
Build history list UI with filtering, search, and details drawer.

Purpose: Allow users to browse, filter, search, and view details of past focus sessions.
Output: History list components, drawer component, hooks for data fetching/filtering.
</objective>

<execution_context>
@/Users/michaelrobert/.claude/get-shit-done/workflows/execute-plan.md
@/Users/michaelrobert/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-history-stats/03-CONTEXT.md
@.planning/phases/03-history-stats/03-RESEARCH.md
@src/types/session.ts
@src/services/sessionStore.ts

# User Decisions (LOCKED - honor exactly)
- History list: compact list rows, medium info density (date, duration, note preview)
- Date format: Numeric (02/19/2026 2:30 PM)
- Tags as inline pills in each row
- Sort: Newest first (default)
- Empty state: Friendly message with CTA
- Pagination: Load more button (not infinite scroll)
- Duration format: Full words ("25 minutes", "1 hour 15 minutes")
- Details view: Slide-out drawer from right (not modal)
- Editing: Auto-save as user types (no save button)
- Deletion: Confirm dialog before deleting
- Date filters: Clickable chips (not dropdown)
- Standard 4 options: Today, 7 days, 30 days, All
- Text search: Instant search (searches notes and tags)
- Filters/search combine with AND logic
</context>

<tasks>

<task type="auto">
  <name>Create date and duration utility functions</name>
  <files>src/utils/dateUtils.ts, src/utils/durationUtils.ts</files>
  <action>
Create two utility files:

1. **src/utils/dateUtils.ts** - Date formatting utilities:
   - `formatDateFull(date: Date | string): string` - Returns "02/19/2026 2:30 PM" format using Intl.DateTimeFormat
   - `formatDateShort(date: Date | string): string` - Returns "02/19/2026" (no time)
   - `getDateRange(filter: 'today' | '7days' | '30days' | 'all')` - Returns {start, end} Date objects or null for 'all'
   - Type: `export type DateFilter = 'today' | '7days' | '30days' | 'all'`

2. **src/utils/durationUtils.ts** - Duration formatting:
   - `formatDurationFull(seconds: number): string` - Returns "25 minutes", "1 hour 15 minutes", "2 hours"
   - `truncateText(text: string, maxLength: number): string` - Truncates with ellipsis
  </action>
  <verify>
- Files created with correct exports
- TypeScript compiles without errors
  </verify>
  <done>
- dateUtils.ts exports formatDateFull, formatDateShort, getDateRange, DateFilter
- durationUtils.ts exports formatDurationFull, truncateText
</done>
</task>

<task type="auto">
  <name>Create useSessionHistory hook with filtering</name>
  <files>src/hooks/useSessionHistory.ts</files>
  <action>
Create useSessionHistory hook that:
- Fetches sessions from IndexedDB via sessionStore.getAllSessions()
- Maintains state: sessions, filteredSessions, dateFilter, searchQuery, isLoading
- Implements filterSessions() function combining date filter AND search (AND logic)
- Date filter options: 'today', '7days', '30days', 'all' (as chips per user decision)
- Search filters by noteText and tags (case-insensitive)
- Returns: { sessions, filteredSessions, dateFilter, searchQuery, setDateFilter, setSearchQuery, isLoading, refetch }
- Use 200ms debounce on search to avoid lag (per research pitfall #2)

Export types: SessionFilters { dateFilter: DateFilter, searchQuery: string }
  </action>
  <verify>
- Hook loads sessions from IndexedDB
- Filters apply correctly (AND logic)
- Debounce works on search input
  </verify>
  <done>
- useSessionHistory hook exists and returns all required state/methods
- Filters combine with AND logic per user decision
- Search debounced at 200ms
</done>
</task>

<task type="auto">
  <name>Create HistoryFilterBar component</name>
  <files>src/components/history/HistoryFilterBar.tsx</files>
  <action>
Create HistoryFilterBar component with:
- Date filter chips: Today, 7 days, 30 days, All (clickable, not dropdown per user decision)
- Text search input with placeholder "Search notes and tags..."
- Active chip highlighted (blue background, white text)
- Filter chips in horizontal row with gap
- Search input with debounced onChange
- Uses styled-components for styling
- Imports: DateFilter type from dateUtils, useSessionHistory props
  </action>
  <verify>
- Component renders 4 filter chips
- Search input present
- Clicking chip updates filter
- Typing in search updates query
  </verify>
  <done>
- HistoryFilterBar has 4 clickable chips
- Search input present with placeholder
- Uses clickable chips (not dropdown)
</done>
</task>

<task type="auto">
  <name>Create HistoryItem component</name>
  <files>src/components/history/HistoryItem.tsx</files>
  <action>
Create HistoryItem component:
- Props: session: SessionRecord, onClick: () => void
- Displays in compact row format:
  - Left: Date (formatDateFull) and Duration (formatDurationFull)
  - Below date: Note preview (truncated to 80 chars via truncateText)
  - Right side: Tags as inline pills/chips
- Tags: small rounded pills, muted colors
- Clickable row (onClick fires)
- Uses styled-components for layout
- Cursor pointer on hover
  </action>
  <verify>
- Shows date, duration, note preview, tags
- Tags render as inline pills
- Click triggers onClick
  </verify>
  <done>
- HistoryItem shows date, duration, truncated note, tags as pills
- Row is clickable
</done>
</task>

<task type="auto">
  <name>Create HistoryList component with pagination</name>
  <files>src/components/history/HistoryList.tsx</files>
  <action>
Create HistoryList component:
- Uses useSessionHistory hook to get filteredSessions
- Renders HistoryFilterBar at top
- Renders list of HistoryItem components
- Empty state: "No sessions yet. Start your first focus session!" with CTA (per user decision)
- Pagination: "Load more" button (not infinite scroll per user decision)
- Load more shows next batch of 20 sessions
- Loading state: simple "Loading..." text
- Uses styled-components for list container
- Sorted newest first (already indexed by 'by-date' in descending order)
  </action>
  <verify>
- Filter bar at top
- Sessions render as list rows
- Empty state shows friendly message
- Load more button works
- Sorted newest first
  </verify>
  <done>
- HistoryList has filter bar, renders items, has empty state, load more button
</done>
</task>

<task type="auto">
  <name>Create HistoryDrawer component (slide-out details)</name>
  <files>src/components/history/HistoryDrawer.tsx</files>
  <action>
Create HistoryDrawer component:
- Props: session: SessionRecord | null, isOpen: boolean, onClose: () => void
- Slide-out from right (not modal per user decision)
- Overlay behind drawer (click to close)
- Shows all details:
  - Full note text (noteText)
  - Start timestamp (formatDateFull)
  - End timestamp (formatDateFull)
  - Duration (formatDurationFull)
  - Tags (editable)
  - Mode (focus)
- Editing: Auto-save as user types (no save button per user decision)
  - Use debounced save (500ms) similar to useSessionNotes pattern
  - Update sessionStore.saveSession() on save
- Deletion: "Delete" button with confirmation dialog before deleting (per user decision)
- Use keyframes from styled-components for slide animation
- Drawer width: 400px max 90vw
  </action>
  <verify>
- Drawer slides in from right
- Shows full note, timestamps, duration, tags
- Auto-save works on edit
- Delete with confirmation dialog
- Click overlay closes drawer
  </verify>
  <done>
- HistoryDrawer slides from right, shows all session details
- Auto-save on edit, delete with confirmation
</done>
</task>

</tasks>

<verification>
- All 8 HIST requirements addressed
- User decisions implemented exactly (chips, drawer, auto-save, delete confirmation)
- Date format matches (numeric, 02/19/2026 2:30 PM)
- Duration format matches (full words)
- Filters/search use AND logic
- Pagination with load more button
</verification>

<success_criteria>
HIST-01: History list displays sessions newest first
HIST-02: Each item shows date, duration, note preview, tags as pills
HIST-03: Click item opens details drawer
HIST-04: Details show full note, timestamps, duration, tags, mode
HIST-05: Details allow editing note and tags with auto-save
HIST-06: Details allow deleting with confirmation
HIST-07: Filter by date range (Today, 7 days, 30 days, All) via chips
HIST-08: Search filters by text in notes/tags with AND logic
</success_criteria>

<output>
After completion, create `.planning/phases/03-history-stats/03-01-SUMMARY.md`
</output>

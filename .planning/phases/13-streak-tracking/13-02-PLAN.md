---
phase: 13-streak-tracking
plan: "02"
type: execute
wave: 2
depends_on: ["13-01"]
files_modified:
  - src/components/stats/StreakDisplay.tsx
  - src/components/stats/CalendarHeatmap.tsx
  - src/features/stats/StatsView.tsx
autonomous: true
requirements:
  - STRK-01
  - STRK-02
  - STRK-04
  - STRK-05
user_setup: []
must_haves:
  truths:
    - "Current streak with flame icon displays in Stats view"
    - "Best streak displays below current streak"
    - "Calendar shows monthly grid with activity indicators"
    - "Calendar uses color coding: gray (0), light blue (1-2), medium blue (3-4), dark blue (5+)"
    - "Today is highlighted with border"
    - "Hover shows session count and total duration"
  artifacts:
    - path: "src/components/stats/StreakDisplay.tsx"
      provides: "Streak count display with flame icon"
    - path: "src/components/stats/CalendarHeatmap.tsx"
      provides: "Monthly calendar grid with color-coded activity"
    - path: "src/features/stats/StatsView.tsx"
      provides: "Stats page showing streak and calendar"
  key_links:
    - from: "StreakDisplay"
      to: "streakSlice"
      via: "useAppSelector"
      pattern: "selectCurrentStreak, selectBestStreak"
    - from: "CalendarHeatmap"
      to: "sessions"
      via: "groupSessionsByDay"
      pattern: "dailyActivity Map"
---

<objective>
Create streak display and calendar heatmap UI components and integrate into Stats view.

Purpose: Display current/best streak with flame icon and calendar heatmap showing daily activity. Color coding per CONTEXT.md: no sessions (gray), 1-2 sessions (light blue), 3-4 sessions (medium blue), 5+ sessions (dark blue).

Output: StreakDisplay.tsx, CalendarHeatmap.tsx, StatsView.tsx updated
</objective>

<execution_context>
@/Users/michaelrobert/.claude/get-shit-done/workflows/execute-plan.md
@/Users/michaelrobert/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/13-streak-tracking/13-CONTEXT.md
@.planning/phases/13-streak-tracking/13-RESEARCH.md
@.planning/phases/13-streak-tracking/13-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create StreakDisplay component</name>
  <files>src/components/stats/StreakDisplay.tsx</files>
  <action>
    Create src/components/stats/StreakDisplay.tsx:

    1. Import { useAppSelector } from '../../app/hooks'
    2. Import { selectCurrentStreak, selectBestStreak, selectProtectionUsed } from '../../features/streak/streakSelectors'
    3. Import { FaFire, FaShieldAlt } from 'react-icons/fa'
    4. Import styled from 'styled-components'

    Component:
    - Container: flex column, gap 16px
    - Current streak row: flame icon + count + "day streak" label
    - Best streak row: "Best: X days" (smaller, secondary color)
    - Protection indicator: shield icon + "Protection active" when currentStreak >= 5 && protectionUsed === false
    - Use styled-components following existing app theme (light mode, blue accents)

    Colors per RESEARCH.md:
    - Flame: #f97316 (orange)
    - Shield: #22c55e (green)
    - Text: use existing theme colors
  </action>
  <verify>TypeScript compiles, component renders without errors</verify>
  <done>StreakDisplay shows current streak with flame, best streak, and protection indicator</done>
</task>

<task type="auto">
  <name>Task 2: Create CalendarHeatmap component</name>
  <files>src/components/stats/CalendarHeatmap.tsx</files>
  <action>
    Create src/components/stats/CalendarHeatmap.tsx:

    1. Import { useMemo, useState } from 'react'
    2. Import { eachDayOfInterval, startOfMonth, endOfMonth, format, isSameDay, isToday } from 'date-fns'
    3. Import styled from 'styled-components'
    4. Import { FaChevronLeft, FaChevronRight } from 'react-icons/fa'

    2. Props interface:
       - dailyActivity: Map<string, { sessionCount: number; totalSeconds: number }>

    3. Component structure:
       - MonthHeader: flex row, arrows + month/year label + arrows
       - CalendarGrid: 7-column CSS grid
       - DayCell: square aspect-ratio, rounded corners
       - Tooltip: on hover show session count and total duration

    4. Color coding per CONTEXT.md:
       - 0 sessions: #e5e7eb (gray)
       - 1-2 sessions: #bfdbfe (light blue)
       - 3-4 sessions: #60a5fa (medium blue)
       - 5+ sessions: #1d4ed8 (dark blue)

    5. Today: border 2px solid #136dec

    6. Navigation: prev/next month arrows update currentMonth state

    7. Use date-fns for all date calculations (local timezone)
  </action>
  <verify>TypeScript compiles, component renders without errors</verify>
  <done>CalendarHeatmap displays monthly grid with color-coded activity and navigation</done>
</task>

<task type="auto">
  <name>Task 3: Integrate streak components into Stats view</name>
  <files>src/features/stats/StatsView.tsx</files>
  <action>
    Update src/features/stats/StatsView.tsx:

    1. Import StreakDisplay from '../../components/stats/StreakDisplay'
    2. Import CalendarHeatmap from '../../components/stats/CalendarHeatmap'
    3. Import { useAppSelector } from '../../app/hooks'
    4. Import { selectSessions } from '../../features/history/historySelectors'
    5. Import { groupSessionsByDay } from '../../utils/streakUtils'

    6. In StatsView component:
       - Get sessions using useAppSelector(selectSessions)
       - Compute dailyActivity: useMemo(() => groupSessionsByDay(sessions), [sessions])
       - Render StreakDisplay at top of Stats view
       - Render CalendarHeatmap below streak display
       - Layout: stack vertically with appropriate spacing

    7. Ensure Stats view maintains existing weekly chart functionality
  </action>
  <verify>TypeScript compiles, build succeeds</verify>
  <done>Stats view displays streak and calendar heatmap alongside existing weekly chart</done>
</task>

</tasks>

<verification>
- [ ] npm run build succeeds without errors
- [ ] StreakDisplay shows current streak with flame icon
- [ ] CalendarHeatmap renders with correct color coding
- [ ] Stats view integrates both components
</verification>

<success_criteria>
- Current streak displayed in Stats view (STRK-01)
- Best streak displayed in Stats view (STRK-02)
- Calendar shows monthly grid with daily activity (STRK-04)
- Color coding: light blue (1-2), medium (3-4), dark (5+) (STRK-05)
</success_criteria>

<output>
After completion, create .planning/phases/13-streak-tracking/13-02-SUMMARY.md
</output>

---
phase: 11-settings-modernization
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/features/settings/settingsSlice.ts
  - src/services/persistence.ts
  - src/app/store.ts
autonomous: true

must_haves:
  truths:
    - "Settings sound preferences (notification sound, volume) managed in Redux"
    - "Sound preferences persist across app restarts"
    - "Default values applied when no saved preferences exist"
  artifacts:
    - path: "src/features/settings/settingsSlice.ts"
      provides: "Redux state management for sound preferences"
      exports: ["setNotificationSound", "setVolume", "loadSettings"]
    - path: "src/services/persistence.ts"
      provides: "Persistence for sound settings in IndexedDB"
      contains: "notificationSound.*volume"
    - path: "src/app/store.ts"
      provides: "Redux store with settings reducer"
      includes: "settingsReducer"
  key_links:
    - from: "settingsSlice.ts"
      to: "persistence.ts"
      via: "loadSettings thunk"
    - from: "store.ts"
      to: "settingsSlice.ts"
      via: "settings reducer configuration"
---

<objective>
Create Redux slice for settings and extend persistence layer for sound preferences

Purpose: Establish Redux state management for notification sound and volume settings, with persistence to IndexedDB. This provides DevTools visibility and ensures settings survive app restarts.

Output: settingsSlice.ts, updated persistence.ts and store.ts
</objective>

<context>
@.planning/phases/11-settings-modernization/11-RESEARCH.md
@src/features/ui/uiSlice.ts
@src/features/session/sessionSlice.ts
@src/services/persistence.ts
</context>

<tasks>

<task type="auto">
  <name>Create settingsSlice.ts for sound preferences</name>
  <files>src/features/settings/settingsSlice.ts</files>
  <action>
Create src/features/settings/settingsSlice.ts with:
- SoundSettingsState interface with notificationSound (string, default: 'beep') and volume (number, default: 80)
- Initial state with defaults
- setNotificationSound action (PayloadAction<string>)
- setVolume action (PayloadAction<number>)
- loadSettings action to load from persistence
- Export { setNotificationSound, setVolume, loadSettings } and reducer

Follow the pattern from sessionSlice.ts and uiSlice.ts for consistency.
  </action>
  <verify>File exists with valid TypeScript exports</verify>
  <done>settingsSlice.ts created with SoundSettingsState, setNotificationSound, setVolume, loadSettings actions</done>
</task>

<task type="auto">
  <name>Extend persistence.ts with sound settings</name>
  <files>src/services/persistence.ts</files>
  <action>
In src/services/persistence.ts:
1. Extend AppSettings interface to include:
   - notificationSound: string (default: 'beep')
   - volume: number (default: 80)
2. Update DEFAULT_SETTINGS to include:
   - notificationSound: 'beep'
   - volume: 80
3. Update saveSettings() to include notificationSound and volume in stored object
4. Update loadSettings() to return notificationSound and volume with fallbacks to DEFAULT_SETTINGS

Preserve all existing timer/session persistence logic.
  </action>
  <verify>TypeScript compiles without errors</verify>
  <done>persistence.ts supports sound settings storage and retrieval</done>
</task>

<task type="auto">
  <name>Add settings reducer to Redux store</name>
  <files>src/app/store.ts</files>
  <action>
In src/app/store.ts:
1. Import settingsReducer from '../features/settings/settingsSlice'
2. Add settings: settingsReducer to the reducer object in configureStore
3. Update the store comment to note Phase 11 settings slice addition
4. Import RootState and export it for use in selectors

Ensure no conflicts with existing slices.
  </action>
  <verify>npm run build succeeds</verify>
  <done>Redux store includes settings reducer, TypeScript compiles</done>
</task>

</tasks>

<verification>
- [ ] settingsSlice.ts created with SoundSettingsState interface
- [ ] setNotificationSound and setVolume actions implemented
- [ ] loadSettings action implemented (async thunk pattern)
- [ ] persistence.ts ExtendedSettings interface includes notificationSound and volume
- [ ] DEFAULT_SETTINGS includes sound defaults
- [ ] saveSettings persists sound settings
- [ ] loadSettings loads sound settings with fallbacks
- [ ] store.ts imports and configures settings reducer
- [ ] Build succeeds without errors
</verification>

<success_criteria>
Settings sound preferences managed in Redux with persistence - no component changes required for basic functionality
</success_criteria>

<output>
After completion, create .planning/phases/11-settings-modernization/11-01-SUMMARY.md
</output>

---
phase: 10-history-slice-and-selectors
plan: '01'
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/store.ts
  - src/features/history/historySlice.ts
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Date range filter state (today/7days/30days/all) is managed in Redux"
    - "Search query state is managed in Redux"
    - "Filter state updates trigger Redux actions correctly"
  artifacts:
    - path: "src/features/history/historySlice.ts"
      provides: "Redux slice for history filter state (dateFilter, searchQuery)"
      exports: ["setDateFilter", "setSearchQuery", "resetFilters", "loadSessions"]
    - path: "src/app/store.ts"
      provides: "Redux store with history reducer added"
      contains: "history: historyReducer"
  key_links:
    - from: "src/features/history/historySlice.ts"
      to: "src/utils/dateUtils"
      via: "import DateFilter type"
      pattern: "DateFilter"
---

<objective>
Create history slice with filter state (dateFilter and searchQuery) managed in Redux.
</objective>

<execution_context>
@/Users/dev/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dev/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/phases/10-history-slice-and-selectors/10-RESEARCH.md
@src/features/timer/timerSlice.ts
@src/features/session/sessionSlice.ts
@src/features/ui/uiSlice.ts
@src/utils/dateUtils.ts
@src/types/session.ts
</context>

<tasks>

<task type="auto">
  <name>Create historySlice.ts with filter state</name>
  <files>src/features/history/historySlice.ts</files>
  <action>
Create src/features/history/historySlice.ts with:

1. Define HistoryState interface with:
   - dateFilter: DateFilter ('today' | '7days' | '30days' | 'all')
   - searchQuery: string
   - sessions: SessionRecord[] (loaded from IndexedDB)
   - isLoading: boolean

2. Set initialState with:
   - dateFilter: 'all'
   - searchQuery: ''
   - sessions: []
   - isLoading: true

3. Create reducers:
   - setDateFilter: Update dateFilter
   - setSearchQuery: Update searchQuery
   - resetFilters: Reset both to defaults
   - loadSessions: Set sessions array and isLoading: false

4. Export actions: setDateFilter, setSearchQuery, resetFilters, loadSessions

Follow the pattern from uiSlice.ts and sessionSlice.ts for consistency.
Use the DateFilter type from utils/dateUtils.ts.
Use SessionRecord type from types/session.ts.
  </files>
  <verify>
- TypeScript compiles: `npx tsc --noEmit` passes
- historySlice exports actions: setDateFilter, setSearchQuery, resetFilters, loadSessions
- State shape matches requirements
  </verify>
  <done>
- historySlice.ts created at src/features/history/historySlice.ts
- All reducers implemented (setDateFilter, setSearchQuery, resetFilters, loadSessions)
- Exports correct action creators
  </done>
</task>

<task type="auto">
  <name>Add history reducer to store</name>
  <files>src/app/store.ts</files>
  <action>
Update src/app/store.ts to:

1. Import historyReducer from '../features/history/historySlice'

2. Add history to the reducer configuration:
   ```typescript
   reducer: {
     timer: timerReducer,
     ui: uiReducer,
     session: sessionReducer,
     history: historyReducer,
   }
   ```

3. Update the store comment to include history slice reference

Follow the same pattern as adding sessionReducer in Phase 9.
  </files>
  <verify>
- TypeScript compiles without errors
- Store includes history in reducer config
- DevTools shows history slice
  </verify>
  <done>
- store.ts updated with history reducer
- Build succeeds
  </done>
</task>

</tasks>

<verification>
- [ ] historySlice.ts created with correct state shape
- [ ] All filter actions exported (setDateFilter, setSearchQuery, resetFilters, loadSessions)
- [ ] store.ts includes history reducer
- [ ] TypeScript compiles without errors
- [ ] Build succeeds with no warnings
</verification>

<success_criteria>
- Date range filter (today/7days/30days/all) state managed in Redux
- Search query state managed in Redux
- Sessions can be loaded from IndexedDB into Redux
- State is accessible via state.history.dateFilter, state.history.searchQuery, state.history.sessions
</success_criteria>

<output>
After completion, create `.planning/phases/10-history-slice-and-selectors/10-01-SUMMARY.md`
</output>
